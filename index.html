<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ðŸŽ“ Attendance Calculator</title>

<!-- Google Font -->
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

<style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Poppins', sans-serif;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    min-height: 100vh;
}

/* Password Screen */
#passwordBox {
    height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    z-index: 1000;
    background: rgba(0, 0, 0, 0.8);
    backdrop-filter: blur(10px);
}

.password-container {
    background: white;
    padding: 40px;
    border-radius: 20px;
    text-align: center;
    width: 380px;
    box-shadow: 0 20px 40px rgba(0,0,0,0.3);
    border: 3px solid #667eea;
    animation: fadeIn 0.5s ease;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(-20px); }
    to { opacity: 1; transform: translateY(0); }
}

.password-container h2 {
    color: #333;
    margin-bottom: 10px;
    font-size: 28px;
}

.password-container p {
    color: #666;
    margin-bottom: 25px;
    font-size: 16px;
}

.password-container .hint {
    background: #f8f9fa;
    padding: 12px;
    border-radius: 10px;
    margin-top: 15px;
    font-size: 14px;
    color: #666;
    border-left: 4px solid #667eea;
}

#password {
    width: 100%;
    padding: 15px;
    font-size: 16px;
    border: 2px solid #ddd;
    border-radius: 10px;
    box-sizing: border-box;
    transition: all 0.3s;
    text-align: center;
    letter-spacing: 2px;
    font-weight: 500;
}

#password:focus {
    border-color: #667eea;
    outline: none;
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
}

#passwordBox button {
    margin-top: 20px;
    padding: 15px;
    width: 100%;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border: none;
    cursor: pointer;
    font-size: 16px;
    border-radius: 10px;
    font-weight: 600;
    transition: all 0.3s;
    letter-spacing: 1px;
}

#passwordBox button:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
}

#error {
    color: #ff4757;
    margin-top: 15px;
    font-size: 14px;
    font-weight: 500;
}

/* Main Content */
#mainContent {
    display: none;
}

.header {
    background: white;
    padding: 25px;
    text-align: center;
    box-shadow: 0 5px 20px rgba(0,0,0,0.1);
    position: sticky;
    top: 0;
    z-index: 100;
}

.header h1 {
    color: #333;
    font-size: 32px;
    font-weight: 700;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 15px;
}

.header h1 i {
    color: #667eea;
}

.main-container {
    max-width: 1200px;
    margin: 30px auto;
    padding: 0 20px;
}

/* Dashboard Layout */
.dashboard {
    display: grid;
    grid-template-columns: 1fr 2fr;
    gap: 30px;
    margin-bottom: 40px;
}

@media (max-width: 992px) {
    .dashboard {
        grid-template-columns: 1fr;
    }
}

/* User Card */
.user-card {
    background: white;
    border-radius: 20px;
    padding: 30px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.08);
    height: fit-content;
}

.user-card h2 {
    color: #333;
    margin-bottom: 25px;
    padding-bottom: 15px;
    border-bottom: 2px solid #f1f3f9;
    font-size: 24px;
}

.input-group {
    margin-bottom: 20px;
}

.input-group label {
    display: block;
    color: #555;
    margin-bottom: 8px;
    font-weight: 500;
    font-size: 14px;
}

.input-group label i {
    margin-right: 8px;
    color: #667eea;
}

.input-group input {
    width: 100%;
    padding: 14px;
    border: 2px solid #e1e5f1;
    border-radius: 10px;
    font-size: 15px;
    transition: all 0.3s;
    background: #f8f9fa;
}

.input-group input:focus {
    border-color: #667eea;
    background: white;
    outline: none;
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
}

/* Subjects Section */
.subjects-section {
    background: white;
    border-radius: 20px;
    padding: 30px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.08);
}

.subjects-section h2 {
    color: #333;
    margin-bottom: 25px;
    padding-bottom: 15px;
    border-bottom: 2px solid #f1f3f9;
    font-size: 24px;
}

.subjects-container {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 25px;
}

.subject-card {
    border: 2px solid #ffcccc;
    padding: 25px;
    border-radius: 15px;
    background: linear-gradient(135deg, #fff5f5 0%, #ffeaea 100%);
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.subject-card.filled {
    border-color: #4cd137;
    background: linear-gradient(135deg, #f5fff7 0%, #e8f5e9 100%);
}

.subject-card.filled::before {
    content: 'âœ“';
    position: absolute;
    top: 10px;
    right: 10px;
    background: #4cd137;
    color: white;
    width: 25px;
    height: 25px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
}

.subject-card h3 {
    color: #333;
    margin-bottom: 20px;
    font-size: 18px;
    display: flex;
    align-items: center;
    gap: 10px;
}

.subject-card h3 i {
    color: #667eea;
}

.subject-inputs {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 15px;
}

.input-column label {
    display: block;
    color: #666;
    margin-bottom: 8px;
    font-size: 13px;
    font-weight: 500;
}

.input-column input {
    width: 100%;
    padding: 12px;
    border: 2px solid #e1e5f1;
    border-radius: 8px;
    font-size: 14px;
    transition: all 0.3s;
    background: white;
}

.input-column input:focus {
    border-color: #667eea;
    outline: none;
    box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.1);
}

/* Action Buttons */
.action-buttons {
    display: flex;
    justify-content: center;
    gap: 20px;
    margin: 40px 0;
}

.action-btn {
    padding: 18px 35px;
    border: none;
    border-radius: 12px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    min-width: 200px;
}

.calculate-btn {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
}

.calculate-btn:hover {
    transform: translateY(-3px);
    box-shadow: 0 15px 30px rgba(102, 126, 234, 0.3);
}

.pdf-btn {
    background: linear-gradient(135deg, #00b09b 0%, #96c93d 100%);
    color: white;
}

.pdf-btn:hover {
    transform: translateY(-3px);
    box-shadow: 0 15px 30px rgba(0, 176, 155, 0.3);
}

/* Report Section */
#reportSection {
    background: white;
    border-radius: 20px;
    padding: 40px;
    margin-top: 30px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.08);
    display: none;
    animation: slideUp 0.5s ease;
}

@keyframes slideUp {
    from { opacity: 0; transform: translateY(30px); }
    to { opacity: 1; transform: translateY(0); }
}

.report-header {
    text-align: center;
    margin-bottom: 40px;
}

.report-header h2 {
    color: #333;
    font-size: 28px;
    margin-bottom: 15px;
}

.report-header p {
    color: #666;
    font-size: 16px;
}

/* Report Stats */
.report-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 25px;
    margin-bottom: 40px;
}

.stat-card {
    background: #f8f9fa;
    padding: 25px;
    border-radius: 15px;
    text-align: center;
    transition: all 0.3s;
    border: 2px solid transparent;
}

.stat-card:hover {
    transform: translateY(-5px);
    border-color: #667eea;
    box-shadow: 0 10px 25px rgba(0,0,0,0.1);
}

.stat-card h4 {
    color: #666;
    font-size: 14px;
    margin-bottom: 10px;
    text-transform: uppercase;
    letter-spacing: 1px;
}

.stat-value {
    font-size: 36px;
    font-weight: 700;
    color: #333;
    margin-bottom: 5px;
}

.stat-perfect { color: #4cd137; }
.stat-excellent { color: #00a8ff; }
.stat-good { color: #9c88ff; }
.stat-average { color: #fbc531; }
.stat-poor { color: #e84118; }

/* Feedback Section */
.feedback-section {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    padding: 30px;
    border-radius: 15px;
    color: white;
    margin-bottom: 30px;
}

.feedback-section h3 {
    margin-bottom: 20px;
    font-size: 22px;
    display: flex;
    align-items: center;
    gap: 10px;
}

.quote-box {
    background: rgba(255, 255, 255, 0.1);
    padding: 20px;
    border-radius: 10px;
    margin-bottom: 20px;
    border-left: 4px solid white;
}

.quote-box p {
    font-style: italic;
    font-size: 16px;
    line-height: 1.6;
}

.quote-author {
    text-align: right;
    margin-top: 10px;
    font-weight: 500;
}

/* Professor Reaction */
.professor-reaction {
    text-align: center;
    padding: 30px;
    background: white;
    border-radius: 15px;
    margin-bottom: 30px;
    border: 3px solid #f1f3f9;
}

.professor-emoji {
    font-size: 80px;
    margin-bottom: 20px;
    display: block;
    animation: bounce 2s infinite;
}

@keyframes bounce {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-10px); }
}

.professor-quote {
    font-size: 20px;
    color: #333;
    font-weight: 600;
    margin-bottom: 15px;
    line-height: 1.5;
}

/* Subject Details */
.subject-details {
    margin-top: 30px;
}

.subject-details h3 {
    color: #333;
    margin-bottom: 20px;
    font-size: 22px;
}

.subject-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 20px;
}

.subject-item {
    background: #f8f9fa;
    padding: 20px;
    border-radius: 12px;
    transition: all 0.3s;
}

.subject-item:hover {
    transform: translateY(-3px);
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
}

.subject-item h4 {
    color: #333;
    margin-bottom: 15px;
    font-size: 16px;
}

.attendance-breakdown {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 15px;
}

.breakdown-item {
    text-align: center;
}

.breakdown-item .label {
    font-size: 12px;
    color: #666;
    margin-bottom: 5px;
}

.breakdown-item .value {
    font-size: 20px;
    font-weight: 700;
    color: #333;
}

.breakdown-item .percent {
    font-size: 14px;
    color: #4cd137;
    font-weight: 600;
}

/* Footer */
.footer {
    background: #1a1a2e;
    color: white;
    padding: 40px 0;
    margin-top: 60px;
}

.footer-content {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 30px;
}

@media (max-width: 768px) {
    .footer-content {
        flex-direction: column;
        text-align: center;
    }
}

.footer-info h3 {
    font-size: 24px;
    margin-bottom: 10px;
    color: #667eea;
}

.footer-info p {
    color: #a0a0c0;
    font-size: 16px;
    line-height: 1.6;
}

.developer-contact {
    background: rgba(102, 126, 234, 0.2);
    padding: 20px;
    border-radius: 12px;
    border: 2px solid #667eea;
}

.developer-contact h4 {
    font-size: 18px;
    margin-bottom: 15px;
    display: flex;
    align-items: center;
    gap: 10px;
}

.contact-details {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.contact-item {
    display: flex;
    align-items: center;
    gap: 10px;
    color: #a0a0c0;
}

.contact-item i {
    color: #667eea;
    font-size: 18px;
}

/* Loading Animation */
.loading {
    display: none;
    text-align: center;
    padding: 30px;
}

.loading-spinner {
    border: 4px solid #f1f3f9;
    border-top: 4px solid #667eea;
    border-radius: 50%;
    width: 50px;
    height: 50px;
    animation: spin 1s linear infinite;
    margin: 0 auto 20px;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* Toast Notification */
.toast {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background: #4cd137;
    color: white;
    padding: 15px 25px;
    border-radius: 10px;
    box-shadow: 0 10px 25px rgba(76, 209, 55, 0.3);
    display: none;
    z-index: 1000;
    animation: slideInRight 0.3s ease;
}

@keyframes slideInRight {
    from { transform: translateX(100%); opacity: 0; }
    to { transform: translateX(0); opacity: 1; }
}
</style>
</head>

<body>
<!-- PASSWORD SCREEN -->
<div id="passwordBox">
    <div class="password-container">
        <h2><i class="fas fa-lock"></i> Secure Access</h2>
        <p>Enter password to access Attendance Calculator</p>
        <input type="password" id="password" placeholder="Enter access password">
        <button onclick="checkPassword()"><i class="fas fa-unlock"></i> ACCESS CALCULATOR</button>
        <p id="error"></p>
        <div class="hint">
            <i class="fas fa-lightbulb"></i> Hint: Developer's contact number
        </div>
    </div>
</div>

<!-- TOAST NOTIFICATION -->
<div id="toast" class="toast"></div>

<!-- MAIN WEBSITE -->
<div id="mainContent">
    <!-- Header -->
    <div class="header">
        <h1><i class="fas fa-calculator"></i> Attendance Calculator Pro</h1>
    </div>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Dashboard -->
        <div class="dashboard">
            <!-- User Details Card -->
            <div class="user-card">
                <h2><i class="fas fa-user-graduate"></i> Student Details</h2>
                <div class="input-group">
                    <label><i class="fas fa-user"></i> Full Name *</label>
                    <input type="text" id="name" placeholder="Enter your full name">
                </div>
                <div class="input-group">
                    <label><i class="fas fa-id-card"></i> Roll Number *</label>
                    <input type="text" id="roll" placeholder="Enter roll number">
                </div>
                <div class="input-group">
                    <label><i class="fas fa-users"></i> Section</label>
                    <input type="text" id="section" placeholder="e.g., A, B, C">
                </div>
                <div class="input-group">
                    <label><i class="fas fa-calendar-alt"></i> Academic Year</label>
                    <input type="text" id="year" placeholder="e.g., 2023-2024">
                </div>
                <div class="input-group">
                    <label><i class="fas fa-book"></i> Semester</label>
                    <input type="text" id="sem" placeholder="e.g., Semester 4">
                </div>
            </div>

            <!-- Subjects Section -->
            <div class="subjects-section">
                <h2><i class="fas fa-book-open"></i> Subjects Attendance</h2>
                <div class="subjects-container" id="subjects"></div>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="action-buttons">
            <button class="action-btn calculate-btn" onclick="calculateAttendance()">
                <i class="fas fa-calculator"></i> CALCULATE ATTENDANCE
            </button>
            <button class="action-btn pdf-btn" onclick="downloadPDF()">
                <i class="fas fa-file-pdf"></i> DOWNLOAD PDF REPORT
            </button>
        </div>

        <!-- Loading -->
        <div id="loading" class="loading">
            <div class="loading-spinner"></div>
            <p>Generating your attendance report...</p>
        </div>

        <!-- Report Section -->
        <div id="reportSection"></div>
    </div>

    <!-- Footer -->
    <div class="footer">
        <div class="footer-content">
            <div class="footer-info">
                <h3>Attendance Calculator Pro</h3>
                <p>A comprehensive tool for students to track and calculate their attendance percentage with detailed analytics and insights.</p>
            </div>
            <div class="developer-contact">
                <h4><i class="fas fa-code"></i> Developed By</h4>
                <div class="contact-details">
                    <div class="contact-item">
                        <i class="fas fa-user"></i>
                        <span>Ezaz Khan</span>
                    </div>
                    <div class="contact-item">
                        <i class="fas fa-envelope"></i>
                        <span>khanezazmkm@gmail.com</span>
                    </div>
                    <div class="contact-item">
                        <i class="fas fa-phone"></i>
                        <span>+91 9101188370</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- REQUIRED LIBRARIES -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>
// PASSWORD FUNCTION
function checkPassword() {
    const correctPassword = "anandi";
    const enteredPassword = document.getElementById("password").value;
    const errorElement = document.getElementById("error");

    if (enteredPassword === correctPassword) {
        document.getElementById("passwordBox").style.opacity = "0";
        setTimeout(() => {
            document.getElementById("passwordBox").style.display = "none";
            document.getElementById("mainContent").style.display = "block";
            showToast("Welcome to Attendance Calculator Pro! ðŸŽ‰");
        }, 500);
    } else {
        errorElement.innerText = "Incorrect password! Hint: It's the developer's contact number";
        document.getElementById("password").value = "";
        document.getElementById("password").focus();
    }
}

document.getElementById("password").addEventListener("keypress", function(event) {
    if (event.key === "Enter") {
        checkPassword();
    }
});

// TOAST NOTIFICATION
function showToast(message) {
    const toast = document.getElementById("toast");
    toast.innerHTML = `<i class="fas fa-check-circle"></i> ${message}`;
    toast.style.display = "block";
    setTimeout(() => {
        toast.style.display = "none";
    }, 3000);
}

// QUOTES DATABASE (12 different quotes)
const quotes = [
    {
        text: "The beautiful thing about learning is that no one can take it away from you.",
        author: "B.B. King"
    },
    {
        text: "Education is the passport to the future, for tomorrow belongs to those who prepare for it today.",
        author: "Malcolm X"
    },
    {
        text: "Don't let what you cannot do interfere with what you can do.",
        author: "John Wooden"
    },
    {
        text: "The only way to do great work is to love what you do.",
        author: "Steve Jobs"
    },
    {
        text: "Success is not final, failure is not fatal: it is the courage to continue that counts.",
        author: "Winston Churchill"
    },
    {
        text: "Your time is limited, don't waste it living someone else's life.",
        author: "Steve Jobs"
    },
    {
        text: "The future belongs to those who believe in the beauty of their dreams.",
        author: "Eleanor Roosevelt"
    },
    {
        text: "It does not matter how slowly you go as long as you do not stop.",
        author: "Confucius"
    },
    {
        text: "Believe you can and you're halfway there.",
        author: "Theodore Roosevelt"
    },
    {
        text: "Education is not preparation for life; education is life itself.",
        author: "John Dewey"
    },
    {
        text: "The only person you are destined to become is the person you decide to be.",
        author: "Ralph Waldo Emerson"
    },
    {
        text: "Don't watch the clock; do what it does. Keep going.",
        author: "Sam Levenson"
    }
];

// SUBJECTS
let defaultSubjects = [
    "Physical Pharmacy",
    "Pharmaceutical Organic Chemistry",
    "Pharmaceutical Microbiology",
    "Pharmaceutical Engineering"
];

function loadDefaultSubjects() {
    let box = document.getElementById("subjects");
    box.innerHTML = "";

    defaultSubjects.forEach((sub, index) => {
        box.innerHTML += `
        <div class="subject-card" id="subjectBox_${index}">
            <h3><i class="fas fa-book"></i> ${sub}</h3>
            <div class="subject-inputs">
                <div class="input-column">
                    <label>Theory Total Days</label>
                    <input type="number" id="t_total_${index}" min="0" placeholder="Total" oninput="checkSubjectFilled(${index})">
                    <label>Theory Attended Days</label>
                    <input type="number" id="t_att_${index}" min="0" placeholder="Attended" oninput="checkSubjectFilled(${index})">
                </div>
                <div class="input-column">
                    <label>Lab Total Days</label>
                    <input type="number" id="l_total_${index}" min="0" placeholder="Total" oninput="checkSubjectFilled(${index})">
                    <label>Lab Attended Days</label>
                    <input type="number" id="l_att_${index}" min="0" placeholder="Attended" oninput="checkSubjectFilled(${index})">
                </div>
            </div>
        </div>`;
    });
}

// Check if subject box has all values filled
function checkSubjectFilled(index) {
    const t_total = document.getElementById(`t_total_${index}`).value;
    const t_att = document.getElementById(`t_att_${index}`).value;
    const l_total = document.getElementById(`l_total_${index}`).value;
    const l_att = document.getElementById(`l_att_${index}`).value;
    
    const subjectBox = document.getElementById(`subjectBox_${index}`);
    
    if (t_total && t_att && l_total && l_att) {
        subjectBox.classList.add('filled');
    } else {
        subjectBox.classList.remove('filled');
    }
}

// Initialize on load
document.addEventListener('DOMContentLoaded', loadDefaultSubjects);

// CALCULATE ATTENDANCE
async function calculateAttendance() {
    // Show loading
    document.getElementById('loading').style.display = 'block';
    
    // Simulate loading for better UX
    setTimeout(() => {
        performCalculation();
    }, 800);
}

function performCalculation() {
    let name = document.getElementById("name").value.trim();
    let roll = document.getElementById("roll").value.trim();

    if (name === "" || roll === "") {
        showToast("Please enter Name and Roll Number!");
        document.getElementById('loading').style.display = 'none';
        return;
    }

    let section = document.getElementById("section").value || "Not specified";
    let year = document.getElementById("year").value || "Not specified";
    let sem = document.getElementById("sem").value || "Not specified";

    // Calculate overall percentage
    let totalPercentage = 0;
    let subjectCount = 0;
    let subjectReports = [];

    defaultSubjects.forEach((sub, index) => {
        let t_total = Number(document.getElementById(`t_total_${index}`).value) || 0;
        let t_att = Number(document.getElementById(`t_att_${index}`).value) || 0;
        let l_total = Number(document.getElementById(`l_total_${index}`).value) || 0;
        let l_att = Number(document.getElementById(`l_att_${index}`).value) || 0;

        t_att = Math.min(t_att, t_total);
        l_att = Math.min(l_att, l_total);

        let t_percent = t_total > 0 ? ((t_att / t_total) * 100).toFixed(2) : 0;
        let l_percent = l_total > 0 ? ((l_att / l_total) * 100).toFixed(2) : 0;

        if (t_total > 0) {
            totalPercentage += Number(t_percent);
            subjectCount++;
        }
        if (l_total > 0) {
            totalPercentage += Number(l_percent);
            subjectCount++;
        }

        subjectReports.push({
            name: sub,
            theory: { percent: t_percent, attended: t_att, total: t_total },
            lab: { percent: l_percent, attended: l_att, total: l_total }
        });
    });

    let overall = subjectCount > 0 ? (totalPercentage / subjectCount).toFixed(2) : 0;
    
    // Get random quote
    const randomQuote = quotes[Math.floor(Math.random() * quotes.length)];
    
    // Build report
    let reportHTML = `
        <div class="report-header">
            <h2><i class="fas fa-chart-line"></i> Attendance Analysis Report</h2>
            <p>Generated on ${new Date().toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}</p>
        </div>
        
        <div class="report-stats">
            <div class="stat-card">
                <h4>Overall Attendance</h4>
                <div class="stat-value ${getStatClass(overall)}">${overall}%</div>
                <p>${getAttendanceStatus(overall)}</p>
            </div>
            
            <div class="stat-card">
                <h4>Subjects Tracked</h4>
                <div class="stat-value" style="color: #667eea;">${subjectReports.length}</div>
                <p>${subjectReports.length} Subjects Analyzed</p>
            </div>
            
            <div class="stat-card">
                <h4>Attendance Level</h4>
                <div class="stat-value" style="color: #${getLevelColor(overall)};">${getAttendanceLevel(overall)}</div>
                <p>${getAttendanceComment(overall)}</p>
            </div>
        </div>
        
        <div class="feedback-section">
            <h3><i class="fas fa-quote-left"></i> Today's Inspiration</h3>
            <div class="quote-box">
                <p>"${randomQuote.text}"</p>
                <div class="quote-author">- ${randomQuote.author}</div>
            </div>
        </div>
        
        <div class="professor-reaction">
            <span class="professor-emoji">${getProfessorEmoji(overall)}</span>
            <div class="professor-quote">"${getProfessorReaction(overall)}"</div>
            <p><em>- Your Professor's Feedback</em></p>
        </div>
        
        <div class="subject-details">
            <h3><i class="fas fa-clipboard-list"></i> Detailed Subject Analysis</h3>
            <div class="subject-grid">`;
    
    subjectReports.forEach((subject, index) => {
        const theoryColor = subject.theory.percent >= 75 ? '#4cd137' : subject.theory.percent >= 60 ? '#fbc531' : '#e84118';
        const labColor = subject.lab.percent >= 75 ? '#4cd137' : subject.lab.percent >= 60 ? '#fbc531' : '#e84118';
        
        reportHTML += `
            <div class="subject-item">
                <h4>${subject.name}</h4>
                <div class="attendance-breakdown">
                    <div class="breakdown-item">
                        <div class="label">Theory</div>
                        <div class="value">${subject.theory.attended}/${subject.theory.total}</div>
                        <div class="percent" style="color: ${theoryColor};">${subject.theory.percent}%</div>
                    </div>
                    <div class="breakdown-item">
                        <div class="label">Lab</div>
                        <div class="value">${subject.lab.attended}/${subject.lab.total}</div>
                        <div class="percent" style="color: ${labColor};">${subject.lab.percent}%</div>
                    </div>
                </div>
            </div>`;
    });
    
    reportHTML += `
            </div>
        </div>`;
        
   // Show report
    const reportSection = document.getElementById("reportSection");
    reportSection.innerHTML = reportHTML;
    reportSection.style.display = "block";
    
    // Hide loading
    document.getElementById('loading').style.display = 'none';
    
    // Scroll to report
    setTimeout(() => {
        reportSection.scrollIntoView({ behavior: 'smooth' });
        showToast("Attendance report generated successfully! ðŸ“Š");
    }, 100);
    
    // Play sound based on attendance
    playAttendanceSound(Number(overall));
}

// Helper functions
function getStatClass(percentage) {
    if (percentage >= 90) return "stat-perfect";
    if (percentage >= 75) return "stat-excellent";
    if (percentage >= 60) return "stat-good";
    if (percentage >= 40) return "stat-average";
    return "stat-poor";
}

function getAttendanceStatus(percentage) {
    if (percentage >= 90) return "Excellent Performance ðŸŽ¯";
    if (percentage >= 75) return "Good Attendance ðŸ‘";
    if (percentage >= 60) return "Satisfactory Level âš–ï¸";
    if (percentage >= 40) return "Needs Improvement ðŸ“ˆ";
    return "Critical Attention Required âš ï¸";
}

function getAttendanceLevel(percentage) {
    if (percentage >= 90) return "Excellent";
    if (percentage >= 75) return "Good";
    if (percentage >= 60) return "Average";
    if (percentage >= 40) return "Poor";
    return "Critical";
}

function getLevelColor(percentage) {
    if (percentage >= 90) return "4cd137";
    if (percentage >= 75) return "00a8ff";
    if (percentage >= 60) return "fbc531";
    if (percentage >= 40) return "e84118";
    return "7f8fa6";
}

function getAttendanceComment(percentage) {
    if (percentage >= 90) return "You're acing it!";
    if (percentage >= 75) return "Keep it up!";
    if (percentage >= 60) return "Room for improvement";
    if (percentage >= 40) return "Need to attend more";
    return "Immediate action needed";
}

function getProfessorEmoji(percentage) {
    if (percentage >= 90) return "ðŸ¤©";
    if (percentage >= 75) return "ðŸ˜Š";
    if (percentage >= 60) return "ðŸ˜";
    if (percentage >= 40) return "ðŸ¤¨";
    return "ðŸ˜¡";
}

function getProfessorReaction(percentage) {
    if (percentage >= 90) return "Outstanding performance! You're setting a great example for others.";
    if (percentage >= 75) return "Good work! Your consistent attendance is paying off.";
    if (percentage >= 60) return "Acceptable, but there's room for improvement. Try to attend more regularly.";
    if (percentage >= 40) return "Your attendance needs immediate attention. Please prioritize your classes.";
    return "This level of attendance is concerning. Please meet with me to discuss your progress.";
}

// SOUND SYSTEM
function playAttendanceSound(percentage) {
    try {
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        const oscillator = audioContext.createOscillator();
        const gainNode = audioContext.createGain();
        
        oscillator.connect(gainNode);
        gainNode.connect(audioContext.destination);
        
        if (percentage >= 90) {
            oscillator.type = 'sine';
            oscillator.frequency.setValueAtTime(523.25, audioContext.currentTime);
            oscillator.frequency.setValueAtTime(659.25, audioContext.currentTime + 0.2);
            oscillator.frequency.setValueAtTime(783.99, audioContext.currentTime + 0.4);
            gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.6);
            oscillator.start();
            oscillator.stop(audioContext.currentTime + 0.6);
        } else if (percentage >= 75) {
            oscillator.type = 'triangle';
            oscillator.frequency.setValueAtTime(440, audioContext.currentTime);
            oscillator.frequency.exponentialRampToValueAtTime(880, audioContext.currentTime + 0.3);
            gainNode.gain.setValueAtTime(0.08, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.4);
            oscillator.start();
            oscillator.stop(audioContext.currentTime + 0.4);
        } else if (percentage >= 60) {
            oscillator.type = 'sine';
            oscillator.frequency.setValueAtTime(392, audioContext.currentTime);
            oscillator.frequency.exponentialRampToValueAtTime(523.25, audioContext.currentTime + 0.3);
            gainNode.gain.setValueAtTime(0.07, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.4);
            oscillator.start();
            oscillator.stop(audioContext.currentTime + 0.4);
        } else if (percentage >= 40) {
            oscillator.type = 'sawtooth';
            oscillator.frequency.setValueAtTime(329.63, audioContext.currentTime);
            oscillator.frequency.exponentialRampToValueAtTime(261.63, audioContext.currentTime + 0.4);
            gainNode.gain.setValueAtTime(0.08, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
            oscillator.start();
            oscillator.stop(audioContext.currentTime + 0.5);
        } else {
            oscillator.type = 'square';
            oscillator.frequency.setValueAtTime(220, audioContext.currentTime);
            oscillator.frequency.exponentialRampToValueAtTime(110, audioContext.currentTime + 0.5);
            gainNode.gain.setValueAtTime(0.09, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.6);
            oscillator.start();
            oscillator.stop(audioContext.currentTime + 0.6);
        }
    } catch (e) {
        console.log("Sound error:", e);
    }
}

// FIXED PDF DOWNLOAD FUNCTION - SINGLE PAGE WITH FOOTER
async function downloadPDF() {
    const report = document.getElementById("reportSection");
    if (!report.innerHTML.trim() || report.style.display === "none") {
        showToast("Please calculate attendance first!");
        return;
    }
    
    showToast("Generating PDF report... ðŸ“„");
    
    // Create temporary container for PDF generation
    const tempContainer = document.createElement('div');
    tempContainer.style.position = 'absolute';
    tempContainer.style.left = '-9999px';
    tempContainer.style.top = '0';
    tempContainer.style.width = '794px'; // A4 width in pixels
    tempContainer.style.background = 'white';
    tempContainer.style.padding = '40px';
    tempContainer.style.fontFamily = "'Poppins', sans-serif";
    tempContainer.style.boxSizing = 'border-box';
    
    // Get student data
    const name = document.getElementById("name").value || "Student";
    const roll = document.getElementById("roll").value || "Not specified";
    const section = document.getElementById("section").value || "Not specified";
    const year = document.getElementById("year").value || "Not specified";
    const sem = document.getElementById("sem").value || "Not specified";
    
    // Get overall percentage from report
    let overall = "0.00";
    const overallElement = document.querySelector('.stat-value');
    if (overallElement) {
        overall = overallElement.textContent.replace('%', '');
    }
    
    // Get subject data for PDF table
    let subjectRows = '';
    defaultSubjects.forEach((sub, index) => {
        let t_total = Number(document.getElementById(`t_total_${index}`).value) || 0;
        let t_att = Number(document.getElementById(`t_att_${index}`).value) || 0;
        let l_total = Number(document.getElementById(`l_total_${index}`).value) || 0;
        let l_att = Number(document.getElementById(`l_att_${index}`).value) || 0;
        
        t_att = Math.min(t_att, t_total);
        l_att = Math.min(l_att, l_total);
        
        let t_percent = t_total > 0 ? ((t_att / t_total) * 100).toFixed(2) : 0;
        let l_percent = l_total > 0 ? ((l_att / l_total) * 100).toFixed(2) : 0;
        let total_att = t_att + l_att;
        let total_days = t_total + l_total;
        let total_percent = total_days > 0 ? ((total_att / total_days) * 100).toFixed(2) : 0;
        
        subjectRows += `
            <tr>
                <td style="padding: 12px; border-bottom: 1px solid #eee; font-weight: 600;">${sub}</td>
                <td style="padding: 12px; border-bottom: 1px solid #eee; text-align: center;">${t_att}/${t_total}</td>
                <td style="padding: 12px; border-bottom: 1px solid #eee; text-align: center;">${t_percent}%</td>
                <td style="padding: 12px; border-bottom: 1px solid #eee; text-align: center;">${l_att}/${l_total}</td>
                <td style="padding: 12px; border-bottom: 1px solid #eee; text-align: center;">${l_percent}%</td>
                <td style="padding: 12px; border-bottom: 1px solid #eee; text-align: center; font-weight: 600;">${total_percent}%</td>
            </tr>
        `;
    });
    
    // Build PDF HTML
    tempContainer.innerHTML = `
        <div style="max-width: 714px; margin: 0 auto;">
            <!-- Header -->
            <div style="text-align: center; margin-bottom: 30px; padding-bottom: 20px; border-bottom: 3px solid #667eea;">
                <h1 style="color: #333; margin: 0 0 10px 0; font-size: 32px; font-weight: 700;">
                    <i class="fas fa-calculator"></i> Attendance Analysis Report
                </h1>
                <p style="color: #666; margin: 0; font-size: 16px;">
                    Generated on ${new Date().toLocaleDateString('en-US', { 
                        weekday: 'long', 
                        year: 'numeric', 
                        month: 'long', 
                        day: 'numeric' 
                    })}
                </p>
            </div>
            
            <!-- Student Information -->
            <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 30px;">
                <h2 style="color: #333; margin: 0 0 15px 0; font-size: 20px; border-bottom: 2px solid #e1e5f1; padding-bottom: 10px;">
                    Student Information
                </h2>
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px;">
                    <div>
                        <p style="margin: 8px 0;"><strong>Name:</strong> ${name}</p>
                        <p style="margin: 8px 0;"><strong>Roll Number:</strong> ${roll}</p>
                    </div>
                    <div>
                        <p style="margin: 8px 0;"><strong>Section:</strong> ${section}</p>
                        <p style="margin: 8px 0;"><strong>Academic Year:</strong> ${year}</p>
                        <p style="margin: 8px 0;"><strong>Semester:</strong> ${sem}</p>
                    </div>
                </div>
            </div>
            
                       <!-- Overall Attendance -->
            <div style="text-align: center; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
                    color: white; padding: 30px; border-radius: 15px; margin-bottom: 30px;">
                <h2 style="margin: 0 0 20px 0; font-size: 24px;">Overall Attendance</h2>
                <div style="font-size: 72px; font-weight: 700; margin: 20px 0;">${overall}%</div>
                <div style="font-size: 20px; font-weight: 600;">${getAttendanceStatus(parseFloat(overall))}</div>
            </div>
            
            <!-- Subjects Table -->
            <div style="margin-bottom: 30px;">
                <h2 style="color: #333; margin: 0 0 20px 0; font-size: 22px; border-bottom: 2px solid #e1e5f1; padding-bottom: 10px;">
                    Subject-wise Attendance Details
                </h2>
                <table style="width: 100%; border-collapse: collapse;">
                    <thead>
                        <tr style="background: #667eea; color: white;">
                            <th style="padding: 15px; text-align: left; border-bottom: 2px solid #ddd;">Subject</th>
                            <th style="padding: 15px; text-align: center; border-bottom: 2px solid #ddd;">Theory<br>Attended/Total</th>
                            <th style="padding: 15px; text-align: center; border-bottom: 2px solid #ddd;">Theory %</th>
                            <th style="padding: 15px; text-align: center; border-bottom: 2px solid #ddd;">Lab<br>Attended/Total</th>
                            <th style="padding: 15px; text-align: center; border-bottom: 2px solid #ddd;">Lab %</th>
                            <th style="padding: 15px; text-align: center; border-bottom: 2px solid #ddd;">Total %</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${subjectRows}
                    </tbody>
                </table>
            </div>
            
            <!-- Professor Feedback -->
            <div style="background: #fff9e6; padding: 25px; border-radius: 10px; margin-bottom: 30px; border-left: 5px solid #ffd166;">
                <h2 style="color: #333; margin: 0 0 15px 0; font-size: 20px;">
                    <i class="fas fa-chart-line"></i> Performance Analysis
                </h2>
                <p style="margin: 0 0 10px 0; font-size: 16px; line-height: 1.6;">
                    <strong>Professor's Feedback:</strong> "${getProfessorReaction(parseFloat(overall))}"
                </p>
                <p style="margin: 0; font-size: 14px; color: #666;">
                    <strong>Overall Status:</strong> ${getAttendanceLevel(parseFloat(overall))} 
                    (${getAttendanceComment(parseFloat(overall))})
                </p>
            </div>
            
            <!-- Footer with Developer Info -->
            <div style="text-align: center; padding: 30px 0; border-top: 2px solid #eee; color: #666; font-size: 14px; margin-top: 40px;">
                <div style="background: #f8f9fa; padding: 20px; border-radius: 10px;">
                    <h3 style="color: #667eea; margin: 0 0 15px 0; font-size: 18px;">
                        Attendance Calculator Pro
                    </h3>
                    <p style="margin: 8px 0;">
                        <strong>Developed by:</strong> Ezaz Khan
                    </p>
                    <p style="margin: 8px 0;">
                        <strong>Contact:</strong> +91 9101188370
                    </p>
                    <p style="margin: 8px 0;">
                        <strong>Email:</strong> khanezazmkm@gmail.com
                    </p>
                    <p style="margin: 20px 0 0 0; font-size: 12px; color: #999;">
                        Â© ${new Date().getFullYear()} Attendance Calculator Pro. All rights reserved.
                    </p>
                </div>
            </div>
        </div>
    `;
    // Add to document
    document.body.appendChild(tempContainer);
    
    try {
        // Generate PDF
        const { jsPDF } = window.jspdf;
        
        // Create PDF with A4 dimensions
        const pdf = new jsPDF('p', 'mm', 'a4');
        
        // Generate canvas from temp container
        const canvas = await html2canvas(tempContainer, {
            scale: 2, // Higher quality
            useCORS: true,
            backgroundColor: '#ffffff',
            logging: false,
            width: 794,
            height: tempContainer.scrollHeight
        });
        
        // Calculate dimensions for single page
        const imgWidth = 190; // mm (A4 width - margins)
        const imgHeight = (canvas.height * imgWidth) / canvas.width;
        
        // Check if content fits on one page
        const pageHeight = pdf.internal.pageSize.getHeight() - 20; // 20mm margins
        
        if (imgHeight <= pageHeight) {
            // Single page - fits perfectly
            pdf.addImage(canvas.toDataURL('image/jpeg', 1.0), 'JPEG', 10, 10, imgWidth, imgHeight);
        } else {
            // Scale down to fit one page
            const scaleFactor = pageHeight / imgHeight;
            const scaledWidth = imgWidth * scaleFactor;
            const scaledHeight = pageHeight;
            
            pdf.addImage(canvas.toDataURL('image/jpeg', 1.0), 'JPEG', 
                         (pdf.internal.pageSize.getWidth() - scaledWidth) / 2, 
                         10, 
                         scaledWidth, 
                         scaledHeight);
        }
        
        // Generate filename
        const fileName = `Attendance_Report_${name.replace(/\s+/g, '_')}_${new Date().getTime()}.pdf`;
        
        // Save PDF
        pdf.save(fileName);
        
        // Clean up
        document.body.removeChild(tempContainer);
        
        showToast("PDF downloaded successfully! ðŸ“„");
        
    } catch (error) {
        console.error('PDF Generation Error:', error);
        showToast("Error generating PDF. Please try again.");
        
        // Clean up on error
        if (tempContainer.parentNode) {
            document.body.removeChild(tempContainer);
        }
    }
}
</script>
</body>
</html>